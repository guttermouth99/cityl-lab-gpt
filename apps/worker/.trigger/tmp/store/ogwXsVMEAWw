{
  "version": 3,
  "sources": ["../../../src/jobs/scraping/scrape-org-batch.ts"],
  "sourcesContent": ["import { updateOrganization } from \"@baito/db/queries\";\nimport { computeContentHashSync } from \"@baito/shared\";\nimport { task } from \"@trigger.dev/sdk\";\n\ninterface OrgToScrape {\n  id: string;\n  careerPageUrl: string;\n  contentHash: string | null;\n}\n\nexport const scrapeOrgBatch = task({\n  id: \"scrape-org-batch\",\n  retry: {\n    maxAttempts: 2,\n  },\n  run: async (payload: { organizations: OrgToScrape[] }) => {\n    const { organizations } = payload;\n    console.log(`Scraping ${organizations.length} organization career pages`);\n\n    const jinaApiKey = process.env.JINA_API_KEY;\n    if (!jinaApiKey) {\n      throw new Error(\"JINA_API_KEY not configured\");\n    }\n\n    let updated = 0;\n    let unchanged = 0;\n    let errors = 0;\n\n    for (const org of organizations) {\n      try {\n        // Use Jina Reader to fetch the page content\n        const response = await fetch(`https://r.jina.ai/${org.careerPageUrl}`, {\n          headers: {\n            Authorization: `Bearer ${jinaApiKey}`,\n          },\n        });\n\n        if (!response.ok) {\n          console.error(\n            `Failed to scrape ${org.careerPageUrl}: ${response.status}`\n          );\n          errors++;\n          continue;\n        }\n\n        const content = await response.text();\n        const newContentHash = computeContentHashSync(content);\n\n        // Check if content has changed\n        if (newContentHash === org.contentHash) {\n          unchanged++;\n          continue;\n        }\n\n        // Update the organization with new content hash\n        await updateOrganization(org.id, {\n          contentHash: newContentHash,\n        });\n\n        updated++;\n\n        // TODO: Parse content and extract jobs\n        // This would trigger job extraction tasks\n      } catch (error) {\n        console.error(`Error scraping org ${org.id}:`, error);\n        errors++;\n      }\n    }\n\n    return {\n      total: organizations.length,\n      updated,\n      unchanged,\n      errors,\n    };\n  },\n});\n"],
  "mappings": ";;;;;;;;;;;;;AAAA;AAUO,IAAM,iBAAiB,KAAK;AAAA,EACjC,IAAI;AAAA,EACJ,OAAO;AAAA,IACL,aAAa;AAAA,EACf;AAAA,EACA,KAAK,8BAAO,YAA8C;AACxD,UAAM,EAAE,cAAc,IAAI;AAC1B,YAAQ,IAAI,YAAY,cAAc,MAAM,4BAA4B;AAExE,UAAM,aAAa,QAAQ,IAAI;AAC/B,QAAI,CAAC,YAAY;AACf,YAAM,IAAI,MAAM,6BAA6B;AAAA,IAC/C;AAEA,QAAI,UAAU;AACd,QAAI,YAAY;AAChB,QAAI,SAAS;AAEb,eAAW,OAAO,eAAe;AAC/B,UAAI;AAEF,cAAM,WAAW,MAAM,MAAM,qBAAqB,IAAI,aAAa,IAAI;AAAA,UACrE,SAAS;AAAA,YACP,eAAe,UAAU,UAAU;AAAA,UACrC;AAAA,QACF,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AAChB,kBAAQ;AAAA,YACN,oBAAoB,IAAI,aAAa,KAAK,SAAS,MAAM;AAAA,UAC3D;AACA;AACA;AAAA,QACF;AAEA,cAAM,UAAU,MAAM,SAAS,KAAK;AACpC,cAAM,iBAAiB,uBAAuB,OAAO;AAGrD,YAAI,mBAAmB,IAAI,aAAa;AACtC;AACA;AAAA,QACF;AAGA,cAAM,mBAAmB,IAAI,IAAI;AAAA,UAC/B,aAAa;AAAA,QACf,CAAC;AAED;AAAA,MAIF,SAAS,OAAO;AACd,gBAAQ,MAAM,sBAAsB,IAAI,EAAE,KAAK,KAAK;AACpD;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL,OAAO,cAAc;AAAA,MACrB;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,GA5DK;AA6DP,CAAC;",
  "names": []
}
