{
  "version": 3,
  "sources": ["../../../src/jobs/feeds/sync-stepstone.ts"],
  "sourcesContent": ["import { chunk } from \"@baito/shared\";\nimport { schedules } from \"@trigger.dev/sdk\";\nimport { processFeedBatch } from \"./process-feed-batch\";\n\ninterface FeedJob {\n  externalId: string;\n  title: string;\n  description: string;\n  organizationName: string;\n  url: string;\n  location?: string;\n}\n\nexport const syncStepstone = schedules.task({\n  id: \"sync-stepstone\",\n  // Run every hour\n  cron: \"0 * * * *\",\n  run: async () => {\n    const feedUrl = process.env.STEPSTONE_FEED_URL;\n    if (!feedUrl) {\n      throw new Error(\"STEPSTONE_FEED_URL not configured\");\n    }\n\n    // Fetch the feed\n    console.log(\"Fetching Stepstone feed...\");\n    const response = await fetch(feedUrl);\n    const feedData = (await response.json()) as FeedJob[];\n\n    console.log(`Found ${feedData.length} jobs in feed`);\n\n    // Chunk into batches of 50\n    const batches = chunk(feedData, 50);\n    console.log(`Split into ${batches.length} batches`);\n\n    // Spawn batch processing tasks\n    const batchTasks = batches.map((batch, index) =>\n      processFeedBatch.trigger({\n        batchIndex: index,\n        jobs: batch,\n        source: \"stepstone\",\n      })\n    );\n\n    await Promise.all(batchTasks);\n\n    return {\n      totalJobs: feedData.length,\n      batches: batches.length,\n    };\n  },\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;AAAA;AAaO,IAAM,gBAAgB,kBAAU,KAAK;AAAA,EAC1C,IAAI;AAAA;AAAA,EAEJ,MAAM;AAAA,EACN,KAAK,mCAAY;AACf,UAAM,UAAU,QAAQ,IAAI;AAC5B,QAAI,CAAC,SAAS;AACZ,YAAM,IAAI,MAAM,mCAAmC;AAAA,IACrD;AAGA,YAAQ,IAAI,4BAA4B;AACxC,UAAM,WAAW,MAAM,MAAM,OAAO;AACpC,UAAM,WAAY,MAAM,SAAS,KAAK;AAEtC,YAAQ,IAAI,SAAS,SAAS,MAAM,eAAe;AAGnD,UAAM,UAAU,MAAM,UAAU,EAAE;AAClC,YAAQ,IAAI,cAAc,QAAQ,MAAM,UAAU;AAGlD,UAAM,aAAa,QAAQ;AAAA,MAAI,CAAC,OAAO,UACrC,iBAAiB,QAAQ;AAAA,QACvB,YAAY;AAAA,QACZ,MAAM;AAAA,QACN,QAAQ;AAAA,MACV,CAAC;AAAA,IACH;AAEA,UAAM,QAAQ,IAAI,UAAU;AAE5B,WAAO;AAAA,MACL,WAAW,SAAS;AAAA,MACpB,SAAS,QAAQ;AAAA,IACnB;AAAA,EACF,GAhCK;AAiCP,CAAC;",
  "names": []
}
